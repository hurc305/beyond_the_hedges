<!doctype><html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>HURC305 Template</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" type="image/x-icon" href="http://cartodb.github.io/odyssey.js/sandbox/favicon.png">
  <link rel="icon" type="image/png" href="http://cartodb.github.io/odyssey.js/sandbox/favicon.png">

  <link rel="stylesheet" href="http://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/themes/css/cartodb.css">
  <link rel="stylesheet" href="http://cartodb.github.io/odyssey.js/sandbox/css/slides.css">
  <link rel="stylesheet" href="css/custom_style.css" type="text/css" media="screen">
  <link rel="stylesheet" href="css/thomas_css.css" type="text/css" media="screen">
  
  <script src="http://cartodb.github.io/odyssey.js/vendor/modernizr-2.6.2.min.js"></script>
  
  <script type="infowindow/html" id="infowindow_video">
        <div class="cartodb-popup v2">
          <a href="#close" class="cartodb-popup-close-button close">X</a>
           <div class="cartodb-popup-content-wrapper">
             <div class="cartodb-popup-content">
               <!-- content.data contains the field info -->
			   <div class=pleasework>
					<iframe id="popvideo" width="260" height="190" src={{content.data.media}} frameborder="0" allowfullscreen></iframe>
					<div id="popphoto"><a href = {{content.data.media}} target="_blank"><img width="260" height="190" src ={{content.data.media}}></a> click image to view large
					</div>
				</div>
			   <h2 style="text-align:center">{{content.data.name}} {{content.data.name}}</h2>
			   <p>{{content.data.description}} {{content.data.media_type}}</p>
             </div>
           </div>
           <div class="cartodb-popup-tip-container"></div>
        </div>
      </script>
</head>
<body>
  <div id="map" style="width: 100%; height: 100%;"></div>

  <div id="slides_container" style="display:block;">
    <ul id="navButtons">
      <li><a class="prev"></a></li>
      <li><a class="next"></a></li>
    </ul>
	<div id="dots"></div>
    <div id="slides"></div>
  </div>

<!-- layer selector div that is populated when layer loads-->
<div id="lselect" class="layer_selector">
			<p>LAYERS</p>
            <ul class="LayerSelector-list">
            </ul>
        </div>

  <div id="credits">
    <span class="title" id="title">Beyond The Hedges</span>
    <span class="author"><strong id="author">HURC305 | Fall 2015</strong> <a href="http://cartodb.github.io/odyssey.js/">Odyssey.js</a><span>
  </span></span></div>
<a href="odyssey_template.html" id="" title="odyssey_template">odyssey_template</a>
  <script src="http://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/cartodb.js"></script>
  <script src="http://cartodb.github.io/odyssey.js/dist/odyssey.js" charset="UTF-8"></script>

  <script>
  //----GLOBAL VARIABLES-----\\
  var sublayers = [];
  var layerCount = 0;

	var resizePID;

    function clearResize() {
      clearTimeout(resizePID);
      resizePID = setTimeout(function() { adjustSlides(); }, 100);
    };

    if (!window.addEventListener) {
      window.attachEvent("resize", function load(event) {
        clearResize();
      });
    } else {
      window.addEventListener("resize", function load(event) {
        clearResize();
      });
    };

    function adjustSlides() {
      var container = document.getElementById("slides_container"),
          slide = document.querySelectorAll('.selected_slide')[0];

      if (slide) {
        if (slide.offsetHeight+169+40+80 >= window.innerHeight) {
          container.style.bottom = "80px";

          var h = container.offsetHeight;

          slide.style.height = h-169+"px";
          slide.classList.add("scrolled");
        } else {
          container.style.bottom = "auto";
          container.style.minHeight = "0";

          slide.style.height = "auto";
          slide.classList.remove("scrolled");
        }
      }
    };

    var resizeAction = O.Action(function() {
      function imageLoaded() {
        counter--;

        if (counter === 0) {
          adjustSlides();
        }
      }
      var images = $('img');
      var counter = images.length;

      images.each(function() {
        if (this.complete) {
          imageLoaded.call( this );
        } else {
          $(this).one('load', imageLoaded);
        }
      });
    });
	

    function click(el) {
      var element = O.Core.getElement(el);
      var t = O.Trigger();

      //TODO: clean properly
      function click() {
        t.trigger();
      }

      if (element) element.onclick = click;

      return t;
    };
	
	// function to add HTML to layer selector
	function createSelector(l_id,lname,slayer){
		$('#lselect ul').append('<li class="layer-toggle" id ='+l_id+'>'+lname+'<span style = "font-size:80%; color:gray;"> ('+l_id+')</span></li>');
		$('#'+l_id).click(function(){
			slayer.toggle();
		});
	}

    O.Template({
      init: function() {
		var seq = O.Triggers.Sequential();

       // var baseurl = this.baseurl = 'black.png';
        var map = this.map = L.map('map').setView([0, 0.0], 4);
        /*var basemap = this.basemap = L.tileLayer(baseurl, {
          attribution: 'data OSM - map CartoDB'
        }).addTo(map);*/
		
        // enanle keys to move
        O.Keys().on('map').left().then(seq.prev, seq)
        O.Keys().on('map').right().then(seq.next, seq)
		
		//log lat and lon of mouse click on map -- can/should be disabled
		map.on('click', function(e) {
		    console.log("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng);
			console.log("Zoom: " + this.getZoom());
		});
        
		click(document.querySelectorAll('.next')).then(seq.next, seq)
        click(document.querySelectorAll('.prev')).then(seq.prev, seq)

        var slides = O.Actions.Slides('slides');
        var story = O.Story()

        this.story = story;
        this.seq = seq;
        this.slides = slides;
        this.progress = O.UI.DotProgress('dots').count(0);
      },

      update: function(actions) {
		var self = this;
        if (!actions.length) return;

        this.story.clear();

       /* if (this.baseurl && (this.baseurl !== actions.global.baseurl)) {
          this.baseurl = actions.global.baseurl || 'http://0.api.cartocdn.com/base-light/{z}/{x}/{y}.png';

          this.basemap.setUrl(this.baseurl);
        }*/

        if (this.cartoDBLayer && ("http://"+self.cartoDBLayer.options.user_name+".cartodb.com/api/v2/viz/"+self.cartoDBLayer.options.layer_definition.stat_tag+"/viz.json" !== actions.global.vizjson)) {
          this.map.removeLayer(this.cartoDBLayer);
		  //alert("map removed?");
          this.cartoDBLayer = null;
          this.created = false;
        }
		
        if (actions.global.vizjson && !this.cartoDBLayer) {
          if (!this.created) { // sendCode debounce < vis loader
            cdb.vis.Loader.get(actions.global.vizjson, function(vizjson) {
              self.map.fitBounds(vizjson.bounds);

              cartodb.createLayer(self.map, vizjson)
                .done(function(layer) {
				  self.cartoDBLayer = layer;
				  
				  /*
				  var scount = layer.getSubLayerCount();
				  for (i=0; i<scount; i++){
					  lname = layer.layers[i].options.layer_name;
					  sublayers.push(i);
					  layer.getSubLayer(i).hide();
				  };
				  */
				  
				  //add information to layer selector
				  layerCount += 1
				  for (var i = 0; i < layer.getSubLayerCount(); i++) {
					  var sublayer = {
						  				id:"",
						  				name:"",
						  				author:"",
						  				slayer:"",
						  				parent:""
						  				
					  }
					  sublayer.slayer = layer.getSubLayer(i);
					  sublayer.id = layerCount+"_"+i;
					  sublayer.name = layer.options.layer_definition.layers[i].options.layer_name;
					  sublayer.author = "Bob";	//TODO: Make this author's name
					  createSelector(sublayer.id,sublayer.name,sublayer.slayer);
					  sublayer.slayer.hide();
						
					  //add layer to the sublayers array
					  sublayers.push(i);		
							}
				  
				 // ADDED an action to the O.Parallel actions under _resetActions below
				 // This is probably not an ideal hack, but avoids having to dig into the Odyssey.JS source code
				 // uses CSS to hide h5 elements from the markdown (#####) where visible layers are stored
				 // jQuery used to retrieve the values and compare them against the  array of sublayers
 				 toggleLayer = function toggleLayer() {
 				    return O.Action({
 				      enter: function() {
 						  /*
						  layer.getSubLayer(tl).show();
						  var lhide;
						  for (lhide in sublayers){
							  if (lhide != tl){layer.getSubLayer(lhide).hide();};
						  }*/
						  var vlayers = $(".selected_slide h4");
						  var hlayers = $(".selected_slide h5");
						  vlayers.each(function(){
							  tl = $(this).text();
							  layer.getSubLayer(tl).show();
							  console.log(tl);
						  });
						  hlayers.each(function(){
							  tl = $(this).text();
							  layer.getSubLayer(tl).hide();
							  console.log(tl);
						  });
					  }
 				    });
 				  }
				/*  
				var sublayer = layer.getSubLayer(0),
                      layer_name = layer.layers[0].options.layer_name,
                      filter = actions.global.cartodb_filter ? " WHERE "+actions.global.cartodb_filter : "";
					  
			 	sublayer.setSQL("SELECT * FROM "+layer_name+filter);
				sublayer.hide();
                */  
				  self.map.addLayer(layer);

                  self._resetActions(actions);
                })
				.on('done', function(layer) {
						 var sublayer = layer.getSubLayer(2);
						  sublayer.infowindow.set({
							  template: $('#infowindow_video').html(),
							  width: 280,
							  maxHeight:280
						  });
						  
						   /*sublayer.on('featureOver', function(e, latlng, pos, data) {
						  var mediatype= data.media_type;
						  if (mediatype=='photo'){
							var foo = $('#themedia').html();
							alert(foo);
							};
         
							});*/
					})
					.on('error', function(err) {
                  console.log("some error occurred: " + err);
                });
            });

            this.created = true;
          }

          return;
        }

        this._resetActions(actions);
      },

      _resetActions: function(actions) {
        // update footer title and author
        var title_ = actions.global.title === undefined ? '' : actions.global.title,
            author_ = actions.global.author === undefined ? 'Using' : 'By '+actions.global.author+' using';

        document.getElementById('title').innerHTML = title_;
        document.getElementById('author').innerHTML = author_;
        document.title = title_ + " | " + author_ +' Odyssey.js';

        var sl = actions;
 	   
        document.getElementById('slides').innerHTML = ''
        this.progress.count(sl.length);

        // create new story
        for(var i = 0; i < sl.length; ++i) {
          var slide = sl[i];
          var tmpl = "<div class='slide' style='diplay:none'>";
		  
          tmpl += slide.html();
          tmpl += "</div>";
          document.getElementById('slides').innerHTML += tmpl;

          this.progress.step(i).then(this.seq.step(i), this.seq)
		  //var visible_layer = i;//temporary, this should be set to layer from viz.json
          var actions = O.Parallel(
            this.slides.activate(i),
            slide(this),
            this.progress.activate(i),
            resizeAction,
			toggleLayer()
          );

          actions.on("finish.app", function() {
            adjustSlides();
          });

          this.story.addState(
            this.seq.step(i),
            actions
          )
        }

        this.story.go(this.seq.current());
	  	
		
	    
		},

      changeSlide: function(n) {
        this.seq.current(n);
      }
	}	); 
  </script>

  <script>
    /*(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-20934186-21', 'cartodb.github.io');
    ga('send', 'pageview');*/
  </script>
<!-->
  <script type="text/javascript" src="http://fast.fonts.net/jsapi/3af16084-ba56-49ca-b37d-0b49b59e1927.js"></script>
-->
<script id="md_template" type="text/template">
```
-title: "Houston's Lindy Hop Embassies"
-author: "Thomas Williamson"
- vizjson: "https://tjw8.cartodb.com/api/v2/viz/1e07d2b2-9d21-11e5-88f9-0ecd1babdde5/viz.json"
```

#Houston's Lindy Hop Embassies
```
- center: [29.738743547471575, -95.39291381835938]
- zoom: 11
```
#### 0
#### 1
#### 2
Lindy Hop is a form of swing dancing that was born in the late 1920s. In this map, we will explore the Lindy Hop dancing venues and cultures that lie hidden in the spaces of businesses and regions of Houston. Each of these venues has its own people, environment, and role in the Lindy Hop scene in Houston and has helped shape my perspective and helps define the space that is Houston.

#The Eldorado Ballroom
```
- center: [29.734346389474535, -95.36491155624388]
- zoom: 16
```
The Eldorado Ballroom is the home to Lindy Hop in the space of Houston. It is the home-base for the Houston Swing Dance Society (HSDS), the Houston Hepcats (HSDS’s performance team), and for my dancing, as I first started dancing at the Eldorado Ballroom. For me and for many others, Eldorado is the central point in Houston for Lindy Hop dancing. It wasn’t the central point until just recently though.

#The Melody Club
```
- center: [29.73248312878873, -95.5182695388794]
- zoom: 15
```
Before Eldorado became the go-to location for Lindy Hop in Houston, Houston Swing Dance Society was based at a venue called The Melody Club, on the west side of Houston.  The Melody Club, after HSDS’s founding in 1997, hosted the HSDS Lindy Hop dances until June of 2013, when it closed down and HSDS moved to Eldorado.

#Downtown Area
```
- center: [29.735389800341288, -95.37566184997559]
- zoom: 14
```
The moving of HSDS to Eldorado brought more Lindy Hop inside the 610 loop and led to the booking of venues and events nearer to Downtown Houston. This area is full of lively venues that either serve food and drinks or is part of a building that does. The lively atmosphere characterized the Midtown, Montrose, and Downtown areas well.

#The Heights
```
- center: [29.79425039165072, -95.42055130004883]
- zoom: 14
```
In Houston's Lindy Hop scene, The Heights is a surprisingly inactive area. Dancing venues tend to rely on a lot of commercial space that The Heights doesn't have. Here you'll find former practice spaces for the Houston Hepcats.

#West Houston
```
- center: [29.75655379144858, -95.51736831665039]
- zoom: 14
```
In West Houston, one will find practice space, workshop locations, and social dancing spots that gain some popularity once or twice a year that are interspersed throughout the area. As Houston spreads out to the West, so do the dancing venues. 

#Royal Sonesta
```
- center: [29.743811219251754, -95.4579734802246]
- zoom: 15
```
Where other venues might serve as embassies to different areas of Houston, the Royal Sonesta serves as an embassy to the Lindy Hop world. Every March, hundreds of people throughout the world gather in this hotel to compete, perform, learn, and social dance for 4 full days.

#Freedom
```
- center: [29.738743547471575, -95.39291381835938]
- zoom: 11
```
Lindy Hop gave a sense of personal and bodily freedom to those who first danced it in the 30s and 40s. As we see, Lindy Hop venues of Houston span a great deal of Houston's West and Inner Loop, and give those who participate in the Lindy Hop community in Houston a spacial freedom in exploring the different venues, places, and interests around the city.
</script>

</body></html>